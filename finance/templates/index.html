{% extends "layout.html" %}

{% block title %}
    Index
{% endblock %}

{% block main %}
    <table>
        <col style="width:25%" />
        <col style="width:25%" />
        <col style="width:25%" />
        <col style="width:25%" />

        <thead>
            <tr>
                <td>SYMBOL</td>
                <td>Shares</td>
                <td>Unit Price</td>
                <td>Total Value</td>
                <td></td>
            </tr>

        </thead>
        <tbody id="portfolio">
        </tbody>
    </table>

    <table>
        <col style="width:100%" />

        <tbody id="summary">
        </tbody>
    </table>


    <script>

        async function fetchpage() {
            let reply = await fetch('/', {method:"POST"});
            let replyt = await reply.text();
            let replyObj = JSON.parse(replyt);

            console.log(replyObj)
            let html = '';
            let totalstockprice = 0;
            let balance = await returnBalance();

            for (let obj of replyObj) {
                shares = obj['shares'];
                price = obj['price'];
                symbol = obj['symbol'];
                total = Number(price) * Number(shares);
                totalstockprice += total;

                html += `
                        <tr>
                        <td>${symbol}</td>
                        <td>${shares}</td>
                        <td>$${price.toFixed(2)}</td>
                        <td>$${total.toFixed(2)} </td>
                        </tr>
                        `
            }

            document.querySelector("#portfolio").innerHTML = html;

            let grandtotal = balance + totalstockprice;

            html =`
                        <tr>
                            <td>Total Stock Value = $${totalstockprice.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Balance = $${balance.toFixed(2)}</td>
                        </tr>
                        <tr>
                            <td>Grand Total = $${grandtotal.toFixed(2)}</td>
                        </tr>
                        `

            document.querySelector("#summary").innerHTML = html;

        }

        fetchpage();


    </script>

{% endblock %}

